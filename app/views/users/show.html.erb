<div class="user-profile">
  <section class="summary">
    <header>
      <h2 class="full-name"><%= @user.full_name %></h2>
      <div class="relationship metaItem">
        <span class="metaName">Relationship:</span>
        <%= @relationship_name %>
      </div>
    </header>
    <div class="body">
      <% if @user.images != [] %>
      <img src="<%= @user.images.first.url %>" alt="<%= @user.full_name %>" class="avatar"/>
      <% end %>
      <div class="metaItem birthday">
        <span class="metaName">Birthday:</span>
        <%= @user.month_date(@user.birthday) %>
      </div>
      <div class="metaItem anniversary">
        <span class="metaName">Anniversary:</span>
        <%= @user.month_date(@user.anniversary) %>
      </div>
    </div>
    <div class="summary-edits">
      <% if current_user || current_user.admin %>
        <% if @relationship_name != "Not available"%>
          <%= link_to "Edit relationship", "/relationships/#{@relationship.id}/edit", remote: true, class: "relationshipEdit" %>
        <% else %>
          <%= form_tag '/relationships', method: :post do %>
          <%= select_tag :relative_type_id, options_for_select(@relative_type_id.collect{ |r| [r.name, r.id] })%>
          <%= hidden_field_tag :user_id, @user.id%>
          <%= submit_tag 'Add relationship' %>
          <% end %><br>
        <% end %>
        <%= link_to "Edit Family Member", "/familymembers/#{@user.id}/edit", remote: true, class: "memberEdit" %>
        <%= link_to "Edit member", "/familymembers/#{@user.id}/edit", remote: true, class: "memberEdit" %>
        <%= link_to "Delete member", "/familymembers/#{@user.id}", :method => :delete, data: { confirm: "Are you sure you want to delete?" }, class: "memberEdit" %>
      <% end %>
    </div>
  </section>

  <section class="activity-feed">
    <h2><%= @user.first_name %>'s Newsfeed</h2>
      <% @reverse_status_updates = @user.status_updates.sort_by { |a| a.updated_at }.reverse %>
      <% @reverse_status_updates.each do |status_update| %>
      <ul>
        <div class="feed-item">
          <li class="date"><%= status_update.month_date_year_time(status_update.updated_at.in_time_zone('Eastern Time (US & Canada)')) %> <% if @user || current_user.admin %>
          <li><%= link_to "Delete post", "/newsfeed/#{status_update.id}", :method => :delete, data: { confirm: "Are you sure you want to delete?" } %>
          <% end %></li>
          <li class="text"><%= status_update.post %></li>
          <% if status_update.url %>
          <li class="text"><img src="<%= status_update.url %>"></li>
          <% end %> 
        </div>
      </ul>

    <% if Like.where(status_update_id: status_update.id). where(user_id: current_user.id).first %>
    <% @like = Like.where(status_update_id: status_update.id). where(user_id: current_user.id).first %>
    <%= form_tag "/likes/#{@like.id}", method: :patch do  %>  
    <%= submit_tag "Like" %> :<%= status_update.likes.where(vote: true).count %></h2>
    <% end %>
  <% else %>
    <%= form_tag "/likes", method: :post do  %>  
    <%= hidden_field_tag :status_update_id, status_update.id %>
    <%= submit_tag "Like" %> :<%= status_update.likes.where(vote: true).count %></h2>
    <% end %>
  <% end %>
  
  <div class="comment">
    <% status_update.comments.each do |comment|%>
      <p>Comment by <%= comment.user.first_name%>: <%= comment.post%> <% comment.id %>
      <% if comment.user == current_user%>
        <%= link_to "Delete comment", "/comments/#{comment.id}", :method => :delete, data: { confirm: "Are you sure you want to delete?" }%></p>
      <% end %>
    <% end %>
    
      <%= form_tag "/comments", method: :post do  %>
      <%= label_tag "Comment:" %>
      <%= text_field_tag :post %>
      <%= hidden_field_tag :status_update_id, status_update.id %>
      <%= submit_tag "Add comment" %><br>
  </div>
      <% end %>
      <hr>
      <% end %>
  </section>

  <section class="gallery">
    <div class="header">
      <h2 class="section-header"><%= @user.first_name %>'s Gallery</h2>
      <p>Click the images below to go through <%= @user.first_name %>'s gallery.</li>  
      <% if @user || current_user.admin %>
        <%= form_tag "/images/new", remote: true, method: :get do  %>
        <%= hidden_field_tag :user_id, @user.id%>
        <%= submit_tag "Add Image" %><br>
      <% end %><br>
      <% end %>
    </div>

      <!-- Images -->
    <ul class="images">
    <% @user.images.each do |image| %>
      <li><img class="profile-images" src="<%= image.url %>"><%= link_to "Delete image", "/images/#{image.id}", :method => :delete, data: { confirm: "Are you sure you want to delete?" } %></li>
    <% end %>
    </div>

  </section>
</div>



